{"ast":null,"code":"import { connectToDatabase, getAllPosts } from \"../../../lib/db\";\nimport { getSession } from \"next-auth/client\";\n\nasync function handler(req, res) {\n  if (req.method === \"POST\") {\n    const data = req.body;\n    const session = await getSession({\n      req: req\n    });\n\n    if (!session) {\n      res.status(401).json({\n        message: \"Not authenticated!\"\n      });\n      return;\n    }\n\n    const posterEmail = session.user.email;\n    const {\n      Type,\n      Category,\n      Title,\n      Description,\n      Question,\n      Date,\n      ReducedImg\n    } = data;\n\n    if (!Type || !Category || !Title || !Description || !Question || !Date || !ReducedImg) {\n      return res.status(400).json({\n        message: \"All fields are required\"\n      });\n    }\n\n    const client = await connectToDatabase();\n    const db = client.db();\n    const result = await db.collection(\"PostedItem\").insertOne({\n      Type: Type,\n      Category: Category,\n      Title: Title,\n      Description: Description,\n      Question: Question,\n      Date: Date,\n      ReducedImg: ReducedImg,\n      posterEmail: posterEmail\n    });\n    res.status(201).json({\n      message: \"Item Posted!\"\n    });\n    client.close();\n  } else {\n    try {\n      const data = await getAllPosts();\n      res.status(200).json(data);\n    } catch (error) {\n      console.error(\"Error:\", error);\n      res.status(500).json({\n        message: \"Internal Server Error: Unable to fetch and Display Posts\"\n      });\n    }\n  }\n}\n\nexport default handler;","map":null,"metadata":{},"sourceType":"module"}